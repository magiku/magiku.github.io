<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【动态路由2】IS-IS | Magiku's药剂屋</title><meta name="author" content="Magiku"><meta name="copyright" content="Magiku"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文将介绍另一项动态路由协议：IS-IS。它与OSPF一样，都属于链路状态协议，都是设备之间通过Hello报文发现彼此、建立邻居、交互链路状态信息、同步LSDB、最后通过SPF算法计算路由信息，并且对整个网络会进行区域划分以减少LSDB的规模，降低对网络资源与设备性能的影响。">
<meta property="og:type" content="article">
<meta property="og:title" content="【动态路由2】IS-IS">
<meta property="og:url" content="https://magiku.github.io/2024/07/01/%E3%80%90%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B12%E3%80%91IS-IS/index.html">
<meta property="og:site_name" content="Magiku&#39;s药剂屋">
<meta property="og:description" content="本文将介绍另一项动态路由协议：IS-IS。它与OSPF一样，都属于链路状态协议，都是设备之间通过Hello报文发现彼此、建立邻居、交互链路状态信息、同步LSDB、最后通过SPF算法计算路由信息，并且对整个网络会进行区域划分以减少LSDB的规模，降低对网络资源与设备性能的影响。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://c4893f9d.telegraph-image-713.pages.dev/file/dcb11262f483239ffc471.png">
<meta property="article:published_time" content="2024-07-01T05:12:26.000Z">
<meta property="article:modified_time" content="2024-07-14T14:03:16.000Z">
<meta property="article:author" content="Magiku">
<meta property="article:tag" content="网络">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://c4893f9d.telegraph-image-713.pages.dev/file/dcb11262f483239ffc471.png"><link rel="shortcut icon" href="https://telegraph-image-713.pages.dev/file/35fde8abe3ef661685f2b.png"><link rel="canonical" href="https://magiku.github.io/2024/07/01/%E3%80%90%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B12%E3%80%91IS-IS/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【动态路由2】IS-IS',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-14 22:03:16'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.8/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://c4893f9d.telegraph-image-713.pages.dev/file/dcb11262f483239ffc471.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Magiku's药剂屋"><span class="site-name">Magiku's药剂屋</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【动态路由2】IS-IS</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-01T05:12:26.000Z" title="发表于 2024-07-01 13:12:26">2024-07-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-14T14:03:16.000Z" title="更新于 2024-07-14 22:03:16">2024-07-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="【动态路由2】IS-IS"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文将介绍另一项动态路由协议：IS-IS，全称intermediate system to intermediate system（中间系统到中间系统）。</p>
<p>它与OSPF一样，都属于链路状态协议，都是设备之间通过Hello报文发现彼此、建立邻居、交互链路状态信息、同步LSDB、最后通过SPF算法计算路由信息，并且对整个网络会进行区域划分以减少LSDB的规模，降低对网络资源与设备性能的影响。</p>
<p>拓展一下，我们都学习过OSI七层网络模型，但是目前我们使用的是TCP&#x2F;IP。这两种协议栈是不相同的，<strong>IS-IS原本是使用于OSI协议栈中，而我们要学习的是被引进到TCP&#x2F;IP中的IS-IS。</strong></p>
<p>而<strong>所谓的IS（intermediate system，中间系统）指的是OSI中的路由器</strong>，因此IS-IS的原意为实现IS之间动态路由信息交互。</p>
<p>在IS-IS中，交互的链路状态信息，被称为LSP（link-state packet），对于OSI模型来说，IS-IS所处层级的报文就叫做packet。</p>
<blockquote>
<p>目前IS-IS主要应用于运营商网络中，所以说实话，各位可能不太会接触到，一般的企业网还是以OSPF为主（甚至是RIP与静态）。因此本文不会介绍的太过细致，尤其是命令配置方面，真的有需要，还请以产品文档为准。</p>
</blockquote>
<p>因为IS-IS与OSPF有很多相似处，并且本文是在OSPF之后出的，所以我就默认各位都学习过OSPF了，将会与OSPF进行参照比较来介绍IS-IS。同时这也是一个复习巩固ospf知识点的机会。</p>
<h1 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h1><p>与OSPF的大致相同点，我们在前文简单描述过，对于链路状态信息以及LSDB是什么的内容则在介绍OSPF的文章中提到过了。</p>
<p>因此我们不再赘述身为链路状态协议是如何通过链路状态信息交互，最后得到路由的基础过程。</p>
<p>先着重介绍IS-IS与OSPF的不同之处，概念术语抛的差不多之后再介绍IS-IS的通信过程。</p>
<blockquote>
<p> 个别部分一样是先介绍简单概念，后面另起一小节详细介绍</p>
</blockquote>
<h2 id="路由器类型"><a href="#路由器类型" class="headerlink" title="路由器类型"></a>路由器类型</h2><p>在IS-IS中，对路由器进行了两种级别的划分，分别是level-1与level-2。值得注意的是路由器可以同时是level-1和level-2，对于这种路由器，我们称之为level-1-2路由器。</p>
<blockquote>
<p>我们可以理解为level-2为OSPF中的骨干路由器，level-1为OSPF中的非骨干区域路由器，而level-1-2则是ABR。</p>
</blockquote>
<h3 id="Level-1-路由器："><a href="#Level-1-路由器：" class="headerlink" title="Level-1 路由器："></a><strong>Level-1 路由器</strong>：</h3><ul>
<li>在 IS-IS 中，Level-1 路由器负责在同一个区域（Level-1 区域）内进行邻居关系建立与链路状态信息交互。</li>
<li>level-1路由器只能与level-1路由器建立邻居与链路状态信息交互。</li>
<li>类似地，在 OSPF 中，非骨干路由器负责在同一个区域内进行路由选择。</li>
</ul>
<h3 id="Level-2-路由器："><a href="#Level-2-路由器：" class="headerlink" title="Level-2 路由器："></a><strong>Level-2 路由器</strong>：</h3><ul>
<li>Level-2 路由器在 IS-IS 中负责在不同区域之间进行路由选择，处于连接不同 Level-1 区域的 Level-2 区域。</li>
<li>level-2路由器只能与level-2路由器建立邻居与链路状态信息交互。</li>
<li>在 OSPF 中，骨干路由器（Backbone Router）扮演类似的角色，位于连接不同区域（OSPF 区域）的骨干区域。</li>
</ul>
<h3 id="Level-1-2-路由器："><a href="#Level-1-2-路由器：" class="headerlink" title="Level-1-2 路由器："></a><strong>Level-1-2 路由器</strong>：</h3><ul>
<li>Level-1-2 路由器是同时具有 Level-1 和 Level-2 路由器功能的路由器</li>
<li>既可以在 Level-1 区域内进行邻居建立，也可以在 Level-2 区域之间进行邻居建立。</li>
<li>在 OSPF 中，ABR（Area Border Router）也具有类似的功能，连接不同 OSPF 区域并负责在它们之间传递链路状态信息。</li>
</ul>
<h3 id="类型总结"><a href="#类型总结" class="headerlink" title="类型总结"></a>类型总结</h3><p>可以说，IS-IS 中的 level-1、level-2 和 level-1-2 路由器与 OSPF 中的非骨干路由器、骨干路由器和 ABR 在功能上有一定的相似性，都是为了实现在不同区域之间的路由选择和信息传递。</p>
<h2 id="系统ID"><a href="#系统ID" class="headerlink" title="系统ID"></a>系统ID</h2><blockquote>
<p>再次提醒，IS-IS协议诞生于OSI协议栈中，“中间系统”这个叫法就是TCP&#x2F;IP中的“路由器”。</p>
</blockquote>
<p>系统ID（system ID）相当于OSPF中的router-id，都是表示区域内的某台路由器。</p>
<p>与router-id一样，IS-IS的系统ID也要求保证在区域内的唯一性。</p>
<p>巧的是，IS-IS是工作于二层，二层的MAC地址本质也是具备全局唯一性，因此，系统ID在不手动配置时，会<strong>默认使用MAC地址</strong>。</p>
<p>也因此，<strong>系统ID为48位二进制，与MAC地址长度一致；也与MAC地址一样默认使用十六进制表示。</strong></p>
<h2 id="区域"><a href="#区域" class="headerlink" title="区域"></a>区域</h2><h3 id="区域-id"><a href="#区域-id" class="headerlink" title="区域 id"></a>区域 id</h3><p>IS-IS使用OSPF中类似area的概念，但不同的时，IS-IS的area长度是可变的，同时，还是使用十六进制的方式书写。</p>
<blockquote>
<p>一般我们描述的区域id都是带有“49.”的前缀，实际上这个49并不属于区域id，49在OSI协议栈中用于表示私有地址。</p>
</blockquote>
<p>值得注意的是，IS-IS中，区域的边界并不是设备。</p>
<p>在OSPF里，假设R2的两端：R1属于area0，R3属于area1。</p>
<ul>
<li>那么我们会配置R2的一个接口属于area0，与R1相连；</li>
<li>R2的另一个接口属于area1，与R3相连。</li>
<li>最终结果就是R2处于area0与area1的边界。</li>
</ul>
<p>而<strong>在IS-IS中，我们仅能配置设备属于单个区域</strong>，对于level-2路由器之间来说：</p>
<ul>
<li>首先考虑R2究竟是要配置为R1所处的区域还是R3所处的区域。</li>
<li>假设R2与R1配置为同一区域，那么R2与R3会进行跨区域邻居建立。</li>
<li>最终结果就是区域的边界是处于R2与R3之间的链路上。</li>
</ul>
<h3 id="区域划分"><a href="#区域划分" class="headerlink" title="区域划分"></a>区域划分</h3><p>刚刚提到的情景说明，强调了“<em>对于level-2路由器之间来说</em> ”，这是因为在IS-IS中，有严格的层次划分。</p>
<p>IS-IS使用两级区域层次结构：Level 1和Level 2。</p>
<p>level-1层次类似于OSPF的常规区域，而且近似于totally NSSA区域；</p>
<p>level-2层次类似于OSPF的骨干区域，值得注意的是L2层次支持跨区域邻居建立。</p>
<blockquote>
<p>老实说，我认为叫成level-1区域和level-2区域对于初学者来说很容易混淆概念。个人认为，应该叫level-1层次、level-2层次，所以本文会采用这个叫法。</p>
</blockquote>
<p>level-1路由器负责区域内路由，<strong>level-1路由器只能与同区域的level-1路由器建立邻居关系。</strong></p>
<p>level-2路由器负责区域间路由，<strong>level-2可以跨区域，或者说无视区域id，与其他level-2路由器建立邻居关系。</strong></p>
<p>也因此，才会存在level-1-2路由器，它即属于level-1路由器，又属于level-2路由器。可以使用它来连接level-1层次与level-2层次，这相当于OSPF中的ABR角色。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><strong>对于IS-IS来说，区域仅仅只是标识，而真正划分骨干区域与常规区域的是level层次。</strong></p>
<p>作为骨干的level-2层次可以包含多个区域。</p>
<p>作为常规的level-1层次需要经过level-1-2路由器与作为骨干的level-2层次相连，最后做到跨区域路由。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://c4893f9d.telegraph-image-713.pages.dev/file/d01bdec3b64367f9277ed.png" style="zoom: 80%;" /><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://c4893f9d.telegraph-image-713.pages.dev/file/6a1bc106b1b026d840cdb.png" style="zoom:67%;" /></p>
<h2 id="NET地址"><a href="#NET地址" class="headerlink" title="NET地址"></a>NET地址</h2><p>系统ID只要求区域内唯一，也就是不同区域内的两台路由器实际可以用同一个系统ID（这在OSPF中也是如此）。</p>
<p>而<strong>NET地址则是全IS-IS网络中对路由器的唯一标识符，它由区域ID+系统ID</strong>+NSAP选择器（默认为00）组成。</p>
<blockquote>
<p>NET&#x3D;network entity title，网络实体名称</p>
</blockquote>
<p>这个概念在OSPF中是不存在的。</p>
<p>事实上，NET地址起源于OSI协议栈中NSAP地址的概念（相当于TCP中的套接字——ip地址+端口号）</p>
<p>NET的示例: 49.0001.1921.6800.1001.00</p>
<blockquote>
<p>请注意，这是一个十六进制的数。</p>
</blockquote>
<ul>
<li>49: AFI (Authority and Format Identifier)，表示这是一个私有地址。（起源于OSI协议栈）</li>
<li>0001: 区域ID</li>
<li>1921.6800.1001: 系统ID</li>
<li>00: NSAP地址中表示上层协议类型的字段，IS-IS不需要，故默认为00。</li>
</ul>
<p>总的来说，我们只关注中间的区域ID与系统ID即可。</p>
<p>只不过在DIS生成的伪节点上，会修改NSAP选择器字段为“01”，有关DIS与伪节点的概念稍后就介绍。</p>
<blockquote>
<p>另外，值得注意的是，区域ID是可变长的，所以推算区域ID是从右往左推——去掉2位的NSAP选择器，再去掉12位系统ID（以16进制算），得到的就是区域ID。</p>
<p>比如49.0000.0000.00001.00的区域ID为49</p>
<p>49.0000.0000.0000.00001.00的区域ID为49.0000</p>
<p>当然，在以太网中，实际开头不需要为49。10.0000.0000.0001.00也是没错的。</p>
</blockquote>
<h2 id="度量值"><a href="#度量值" class="headerlink" title="度量值"></a>度量值</h2><p>IS-IS与OSPF一样都是使用cost值作为度量值，不同的是IS-IS是一个完全独立的数值，默认为10。</p>
<blockquote>
<p>在OSPF中，cost值是链路带宽的值计算过来的。</p>
</blockquote>
<p>所以在不手动修改cost值的情况下，IS-IS的度量值反而更类似于RIP的度量值（跳数）。</p>
<p>不过实际使用中，个别厂商会在自家设备上对IS-IS协议进行魔改，提供自动计算cost的功能。（这个本文不做讨论，可以查看相应的产品文档）。</p>
<h2 id="协议报文"><a href="#协议报文" class="headerlink" title="协议报文"></a>协议报文</h2><p>与OSPF报文采用网络层的IP封装不同，IS-IS的报文采用数据链路层封装，在以太网中，我们称数据链路层的报文为协议数据单元PDU。</p>
<blockquote>
<p>IS-IS工作于二层的好处就是封装解封装效率高。</p>
</blockquote>
<p>IS-IS使用了以下几种PDU进行协议通信。</p>
<h3 id="IIH（IS-IS-Hello）"><a href="#IIH（IS-IS-Hello）" class="headerlink" title="IIH（IS-IS Hello）"></a>IIH（IS-IS Hello）</h3><p>相当于OSPF中的hello报文，一样是用于建立与维护邻居关系。</p>
<p><strong>在IS-IS中存在三种IIH PDU：level-1 LAN IIH、level-2 LAN IIH以及P2P IIH。</strong></p>
<p>前两者用于广播型网络（如以太网）：如果设备为level-1，则它仅收发level-1 IIH；如果设备为level-2，则它仅收发level-2 IIH；level-1-2设备则两者都收发。</p>
<p>而P2P IIH则用于P2P类型的网络中。</p>
<h3 id="LSP（Link-State-Packet）"><a href="#LSP（Link-State-Packet）" class="headerlink" title="LSP（Link-State Packet）"></a>LSP（Link-State Packet）</h3><p>IS-IS使用LSP承载链路状态信息，LSP是一个完整的在链路上传播的报文，因此它类似于OSPF中的LSU(包含其中的多种LSA)。</p>
<p>LSP仅存在level-1 LSP与level-2 LSP两种，并不像OSPF中分了多种LSA。</p>
<h3 id="CSNP（Complete-Sequence-Number-PDU）"><a href="#CSNP（Complete-Sequence-Number-PDU）" class="headerlink" title="CSNP（Complete Sequence Number PDU）"></a>CSNP（Complete Sequence Number PDU）</h3><p>CSNP意为完全序列号报文，也是分level-1与level-2两种，用于在不同的IS-IS邻居关系中。</p>
<p>CSNP类似于OSPF中的DD报文，用途为描述设备中所有的LSP摘要，确保设备之间LSDB的同步。</p>
<h3 id="PSNP（Partial-Sequence-Number-PDU）"><a href="#PSNP（Partial-Sequence-Number-PDU）" class="headerlink" title="PSNP（Partial Sequence Number PDU）"></a>PSNP（Partial Sequence Number PDU）</h3><p>PSNP意为部分序列报文，也是分level-1与level-2两种，PSNP与CSNP的不同之处在于PSNP只包含部分LSP摘要信息，PSNP主要用于请求LSP更新。这相当于OSPF中的LSR报文。</p>
<blockquote>
<p>个别情况下，还会作为确认收到更新LSP报文的回应报文，即OSPF中的LSAck。具体内容后续介绍。</p>
</blockquote>
<h3 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h3><p>LSP并不只在收到PSNP报文请求后才会发布。LSP会周期性的发布，即使没有明显的网络变化。</p>
<p>这个周期通常被称为 “LSP 刷新间隔”，默认值通常为 900 秒（最大生存时间的60%）。</p>
<p>LSP 刷新的目的：</p>
<ul>
<li>确保 LSP 信息的新鲜度。</li>
<li>防止 LSP 因超时而被删除。</li>
<li>允许新加入的路由器获取完整的拓扑信息。</li>
</ul>
<p>当然，除了周期性刷新，拓扑变化也会立即触发 LSP 更新。</p>
<h2 id="DIS与伪节点"><a href="#DIS与伪节点" class="headerlink" title="DIS与伪节点"></a>DIS与伪节点</h2><h3 id="DIS"><a href="#DIS" class="headerlink" title="DIS"></a>DIS</h3><p>在IS-IS中，每个网段会选举一台设备作为DIS（指定中间系统），与OSPF的DR很相似，但有一些重要区别。</p>
<p><strong>选举:</strong></p>
<ul>
<li>基于接口优先级和**系统ID(通常是路由器的MAC地址)**。</li>
<li><strong>优先级最高的路由器成为DIS</strong>。如果优先级相同,则系统ID最高的成为DIS。</li>
<li><strong>没有备份DIS</strong>的概念(与OSPF不同)。当DIS发送故障，立即开始选举新的DIS。</li>
<li><strong>DIS具有抢占性</strong>，即网络中接入优先级更高的设备时，该设备会夺取DIS的名头，成为新的DIS。</li>
</ul>
<p><strong>职责：</strong></p>
<ul>
<li>定期发送CSNP(完整序列号PDU)。</li>
<li>为广播网络创建和维护伪节点LSP。</li>
<li>在网络中泛洪LSP。</li>
</ul>
<p><strong>其他路由器与DIS的关系：</strong></p>
<ul>
<li>所有路由器都与DIS建立邻接关系。</li>
<li>其他路由器通过DIS同步LSDB。</li>
</ul>
<p><strong>报文交换：</strong></p>
<ul>
<li>DIS定期(默认每10秒)在广播网络上发送CSNP。</li>
<li>其他路由器如果发现CSNP中列出的LSP是自己没有的，会发送PSNP请求这些LSP。</li>
<li>DIS负责响应PSNP请求，发送相应的LSP。</li>
</ul>
<h3 id="伪节点"><a href="#伪节点" class="headerlink" title="伪节点"></a>伪节点</h3><p>还有一个很特别的点在于，IS-IS中的DIS虚拟出的伪节点（Pseudonodes）：</p>
<blockquote>
<p>伪节点的NET地址是在DIS的NET地址最后位从00改为01。具体我们之后以拓扑进行详细介绍时看一下LSDB表内信息。</p>
</blockquote>
<p><strong>目的：</strong></p>
<ul>
<li>简化拓扑，减少网络中LSP的数量，每个路由器只需要发布描述它邻居为伪节点的LSP，而不需要发布他与所有其他邻居路由器的关系。</li>
</ul>
<p><strong>其他路由器与伪节点的关系：</strong></p>
<ul>
<li>伪节点代表整个广播网段。</li>
<li><strong>每个路由器(包括DIS)都在其LSP中声明与伪节点的连接。</strong></li>
<li>伪节点LSP由DIS生成和维护，包含了所有连接到该网段的路由器信息。</li>
</ul>
<p><strong>报文交换：</strong></p>
<ul>
<li><strong>路由器不直接与伪节点交换报文。</strong></li>
<li>路由器通过DIS了解伪节点的信息。</li>
</ul>
<h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>DIS负责管理网段，而伪节点简化了网络拓扑的表示。</p>
<p>这种设计大大减少了需要在网络中传播的LSP数量，提高了协议的整体效率。</p>
<p><strong>可以说伪节点与OSPF的type-2 LSA很相似：</strong></p>
<ul>
<li>普通路由器在OSPF中是与DR建立邻接关系，最后由DR发布type-2 LSA描述DR所处网段一共有多少路由器（与我相连，邻居是我）。</li>
<li>普通路由器在IS-IS中则是背地里与所有路由器都建立邻接关系（包括伪节点），但是表面表示为只与伪节点建立邻接关系，最后由DIS发布的伪节点LSP中描述了DIS所处网段一共有多少路由器（与伪节点、也就是我相连，邻居是我）。</li>
</ul>
<h2 id="邻居建立过程"><a href="#邻居建立过程" class="headerlink" title="邻居建立过程"></a>邻居建立过程</h2><h3 id="广播网络"><a href="#广播网络" class="headerlink" title="广播网络"></a>广播网络</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://c4893f9d.telegraph-image-713.pages.dev/file/edc7a54d6949a8277dea7.png"></p>
<p>如图，假设两台level-1在使用千兆以太网连接在一起，都在GE0&#x2F;0&#x2F;0口激活IS-IS。</p>
<ol>
<li><p>由于R1是level-1路由器，因此其发送的hello报文为level-1 IIH。该报文中记录了R1的系统ID以及多个TLV，其中一个TLV记录了R1的区域ID。</p>
<blockquote>
<p>有关TLV是啥，我们稍后介绍。</p>
</blockquote>
</li>
<li><p>R2在其GE0&#x2F;0&#x2F;0口接收到R1的level-1 IIH报文，进行相应的检查（区域是否一致等），检查通过后，R2在其邻居表中记录下R1，并将状态标记为initial（初始化）。</p>
<p>R2发布一个level-1 IIH报文，报文内包含了系统ID、区域TLV，以及自己已记录邻居设备信息（R1的TLV与MAC地址）。</p>
</li>
<li><p>R1收到R2的报文，了解R2已经发现了自己，则将R2记录在邻居表中，并把状态设置为up。</p>
<p>R1也发布一个level-1 IIH报文，报文内包含了系统ID、区域TLV，以及自己已记录邻居设备信息（R2的TLV与MAC地址）。</p>
<p>待R2收到R1的报文，了解R1也发现了自己，则将邻居表中R1的状态也记录为up。</p>
</li>
<li><p>R1与R2彼此状态都为up，我们就认为邻居关系建立起来了。</p>
</li>
<li><p>因为是广播网络，需要选举DIS，所以在邻居关系建立后，路由器会等待两个Hello报文间隔，再进行DIS的选举。</p>
<p>Hello报文中包含Priority字段(优先级)，优先级值最大的将被选举为该广播网的DIS。若优先级相同，接口MAC地址较大的被选举为DIS。（与STP的选举优先级很类似）</p>
</li>
</ol>
<p>以上例子是level-1路由器之间的邻居建立关系；至于level-2路由器，形式也是一样的，只不过level-2路由器是通过另一个组播地址，通过level-2 IIH报文进行关系建立。</p>
<p>可以说，这与OSPF的int状态、2-way状态是一样的。</p>
<p>但请注意，<strong>IS-IS并没有像OSPF那样分邻居与邻接两种关系，对IS-IS来说只有邻居这一种关系。</strong></p>
<h3 id="P2P网络"><a href="#P2P网络" class="headerlink" title="P2P网络"></a>P2P网络</h3><p>在P2P网络中，IS-IS的邻居建立过程存在两种方式：两次握手及三次握手。</p>
<p>两次握手方式不存在确认机制，只要设备在接口收到P2P IIH，并且检查通过后，就直接当作该邻居存在，状态设置为up。（因为是P2P网络，对端只可能存在一台设备）</p>
<p>三次握手方式则需要经过一轮确认（类似广播网络中需要在报文中发现自己的系统ID才确定状态可以设置为up）。</p>
<h4 id="两次握手"><a href="#两次握手" class="headerlink" title="两次握手"></a>两次握手</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://c4893f9d.telegraph-image-713.pages.dev/file/4b0a27dcf365d20e4e67c.png"></p>
<ol>
<li>R3在S1&#x2F;0&#x2F;0口激活了IS-IS，检查到为P2P网络，于是在该接口上发送P2P IIH报文。该hello报文中包含了R3的系统ID、区域TLV。</li>
<li>R4也激活了IS-IS，并收到了R3的P2P IIH，则认为该点对点网络对面的设备为R3，并且链路通的（毕竟收到了该报文），于是邻居表中填写上R3的信息，并标记为up。</li>
<li>反过来，对R3来说也是如此，收到R4的P2P IIH报文后，也标记为up。</li>
</ol>
<h4 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://c4893f9d.telegraph-image-713.pages.dev/file/4612579ae970195f81be9.png"></p>
<p>三次握手机制中，新增了一个特殊的TLV：P2P三向邻接TLV。</p>
<ol>
<li><p>R3在S1&#x2F;0&#x2F;0口激活了IS-IS，检查到为P2P网络，于是在该接口上发送P2P IIH报文。该hello报文中包含了R3的系统ID、区域TLV以及一个三向邻接TLV。由于当前R3设备并没有在该P2P网络中发现其他设备，则该邻接TLV内的邻接状态设置为Dowm</p>
</li>
<li><p>R4收到R3的P2P IIH报文，检查通过后，在其邻居表中添加R3的信息，并将状态设置为Initial。</p>
<p>R4发送一个P2P IIH报文，包含R4的系统ID、区域ID以及记录了邻居系统ID与状态为initial的邻接TLV。</p>
</li>
<li><p>R3收到R4的报文，检查后还发现对方发来的报文包含了自己的信息，不过由于报文内的邻接状态为initial，R3暂时不认为邻接关系建立完毕。</p>
<p>邻接状态为initial意味着R4并没有收到R3的进一步确认信息；对于R3来说便是没有确认到“ <em>R4 是否已经收到并处理了 R3 的信息</em>”。</p>
<p>R3在邻居表内只会将R3的邻居状态设置为initial。</p>
<p>但当R3 发送下一个 P2P IIH 报文时，在这个新的 IIH 报文中，R3 会在三向邻接 TLV 中将 R4 的状态标记为 Up。</p>
<p>这表示 R3 已经收到并确认了 R4 的存在，并准备建立完整的邻接关系。</p>
</li>
<li><p>R4收到信息后，发现了自己的信息，且邻接状态为up，因此邻居表中对R3的状态修改为up，同时发送一个标记R3邻接状态为up的P2P IIH报文。</p>
</li>
<li><p>R3收到邻接状态为up的报文，这时才将邻居R4的状态设置为up。</p>
<p>自此，双方才认为邻接关系建立完毕。</p>
</li>
</ol>
<p>从严格的报文交换角度来看，这个过程涉及四次报文交换。然而，它被称为”三次握手”的原因如下：</p>
<blockquote>
<ol>
<li><p>状态变化的关键点：</p>
<ul>
<li>第一次：初始 Down 状态</li>
<li>第二次：转为 Initial 状态</li>
<li>第三次：最终确认为 Up 状态 这三个关键的状态变化点构成了”三次握手”的核心。</li>
</ul>
</li>
<li><p>功能视角：</p>
<ul>
<li>第一次：通告自己</li>
<li>第二次：确认看到对方并通告自己</li>
<li>第三次：确认双方都已互相看到 从功能上看，这三步完成了必要的信息交换。</li>
</ul>
</li>
<li><p>最后一次交换的作用：</p>
<ul>
<li><p>第四次报文交换主要是为了同步最终状态，可以看作是对第三次握手的确认。</p>
<p>在上述例子的第二次交换时——R3收到R4的报文后，本可以设置为up；再加上第三次交换——R4收到R3的报文，状态更新为up。算起来正好是三次握手即可互相标记为up。</p>
</li>
<li><p>在某些描述中，这可能被视为握手过程完成后的一个额外步骤。</p>
</li>
</ul>
</li>
<li><p>简化的概念模型：</p>
<ul>
<li>称为”三次握手”可能是为了简化理解和描述，突出过程中的关键步骤。</li>
</ul>
</li>
</ol>
</blockquote>
<h2 id="邻居建立后"><a href="#邻居建立后" class="headerlink" title="邻居建立后"></a>邻居建立后</h2><h3 id="广播网络-1"><a href="#广播网络-1" class="headerlink" title="广播网络"></a>广播网络</h3><p>DIS会周期性地泛洪CSNP（默认10秒一次），以确保该网络中地IS-IS设备拥有一致地LSDB。</p>
<p>其他设备收到该CSNP后会将其包含地LSP摘要与自己地LSDB进行对比，如果一致，则忽略该CSNP。</p>
<p>而如果本地LSDB缺少了部分LSP，则向DIS发送PSNP请求这些LSP地详细信息；</p>
<p>DIS收到该PSNP后，将相应地LSP发送给对方。</p>
<p>设备收到DIS发来地LSP后，无需向DIS回复确认收到信息。（毕竟之后还会收到DIS地周期CSNP，如果没收到&#x2F;还是缺，再次申请即可）</p>
<h3 id="P2P网络-1"><a href="#P2P网络-1" class="headerlink" title="P2P网络"></a>P2P网络</h3><p> P2P 网络中不需要DIS，CSNP也仅在邻居关系建立完成时发送一次用于确定要申请更新的LSP，后续不会周期性发布。</p>
<p>对于设备来说，在收到 LSP 后需要发送 PSNP 来确认收到的 LSP，以确保信息的完整性。</p>
<p>如果发送者一直没等到对方用于确认的PSNP，则会重传刚刚的LSP。</p>
<h1 id="报文与LSDB详解"><a href="#报文与LSDB详解" class="headerlink" title="报文与LSDB详解"></a>报文与LSDB详解</h1><p>以下的介绍会在一个简单的拓扑上进行：R1与R2相连，网段为192.168.12.0&#x2F;24，区域ID为10，都是level-1-2路由器，具体的IP地址主机位与系统ID就是R1为1、R2为2。</p>
<h2 id="TLV介绍"><a href="#TLV介绍" class="headerlink" title="TLV介绍"></a>TLV介绍</h2><p>TLV是对IS-IS报文中Type、Length、Value这三个字段的合称。</p>
<p>type表示该TLV的类型、length表示该TLV的整体长度、value存储传递的信息。</p>
<p>在IS-IS报文中，会存在多个TLV，数量不做限制。可以理解为是将ospf中多种LSA类型的机制理念进一步扩大利用。</p>
<p>一些常见的TLV如下：</p>
<table>
<thead>
<tr>
<th>TLV Type</th>
<th>名称</th>
<th>被应用于以下PDU类型中</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Area Addresses，区域地址</td>
<td>IIH、LSP</td>
</tr>
<tr>
<td>2</td>
<td>IS Neighbors（LSP），IS邻居（LSP）</td>
<td>LSP</td>
</tr>
<tr>
<td>6</td>
<td>IS Neighbors（MAC Address），IS邻居（MAC 地址）</td>
<td>LAN IIH</td>
</tr>
<tr>
<td>8</td>
<td>Padding，填充（补足报文整体长度，内容为空白）</td>
<td>IIH</td>
</tr>
<tr>
<td>9</td>
<td>LSP Entries，LSP条目（摘要信息）</td>
<td>SNP</td>
</tr>
<tr>
<td>10</td>
<td>Authentication Information，认证信息</td>
<td>IIH、LSP、SNP</td>
</tr>
<tr>
<td>128</td>
<td>IP Internal Reachability Information，IP内部可达性信息（包含网段与到达该网段的cost值）</td>
<td>LSP</td>
</tr>
<tr>
<td>129</td>
<td>Protocols Supported，支持的协议</td>
<td>IIH、LSP</td>
</tr>
<tr>
<td>130</td>
<td>IP External Reachability Information，IP外部可达性信息（包含网段与到达该网段的cost值）</td>
<td>L2 LSP</td>
</tr>
<tr>
<td>131</td>
<td>Inter-Domain Routing Protocol Information，跨域路由协议信息</td>
<td>L2 LSP</td>
</tr>
<tr>
<td>132</td>
<td>IP Interface Address，设备接口的IP地址</td>
<td>IIH、LSP</td>
</tr>
</tbody></table>
<blockquote>
<p>SNP代指CSNP与PSNP。</p>
</blockquote>
<p>请记住，字段名称是我们人为理解的，对计算机来说，它们传递的是直接的数据信息，不包含字段名称的。</p>
<p>比如说，在抓包软件中，value这个字段的名称在不同的报文中会被称为不同的字段名称。以下是一个hello中的抓包信息：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://c4893f9d.telegraph-image-713.pages.dev/file/4473f8e094d1cf90b0195.png"></p>
<p>通过这个抓包我们也能理解报文中TLV的结构。</p>
<blockquote>
<p>报文特有头部省略了。</p>
</blockquote>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://c4893f9d.telegraph-image-713.pages.dev/file/9f7f09efeb6aa1b0b3fb5.png" style="zoom: 80%;" />

<h2 id="IIH-（hello报文）"><a href="#IIH-（hello报文）" class="headerlink" title="IIH （hello报文）"></a>IIH （hello报文）</h2><p>我们直接以上面的抓包的 IS-IS Hello 报文信息，进行介绍：</p>
<blockquote>
<p>也就是上图的白色背景的内容，灰色背景的内容这里不介绍。</p>
</blockquote>
<ul>
<li>hello报文头部信息：<ul>
<li><strong>Circuit type</strong>: 表示电路类型，这里是 Level 1 和 Level 2。</li>
<li><strong>SystemID {Sender of PDU}</strong>: 发送此 PDU 的系统 ID，为 0000.0000.0001。</li>
<li><strong>Holding timer</strong>: 保持计时器，设置为 30。</li>
<li><strong>PDU length</strong>: 该PDU 长度为 1497 字节。</li>
<li><strong>Priority</strong>: 路由器优先级，优先级为 64。（用于选举DIS）</li>
<li><strong>SystemID {Designated IS}</strong>: DIS的 系统ID 为 0000.0000.0001.01。</li>
</ul>
</li>
<li>以下为各TLV<ul>
<li><strong>Area address(es)</strong>: 区域地址，类型为 1，长度为 2。</li>
<li><strong>IP Interface address(es)</strong>: IP 接口地址，类型为 132，长度为 4。</li>
<li><strong>Protocols Supported</strong>: 支持的协议，类型为 129，长度为 1。</li>
<li><strong>Restart Signaling</strong>: 重启信令，类型为 211，长度为 3。</li>
<li><strong>Multi Topology</strong>: 多拓扑，类型为 229，长度为 2。</li>
<li><strong>Padding</strong>: 填充字段，用于填充报文，类型为 8，长度为 255 和 161。目的是将hello报文的长度补充到1497字节。</li>
</ul>
</li>
</ul>
<h2 id="LSP报文"><a href="#LSP报文" class="headerlink" title="LSP报文"></a>LSP报文</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://c4893f9d.telegraph-image-713.pages.dev/file/c2099acb56f0070600874.png"></p>
<p>该图为LSP报文的抓包信息。其详细内容如下:</p>
<p>根据提供的抓包信息，以下是对其中一些字段的解读：</p>
<ul>
<li>LSP头部信息：<ul>
<li><strong>PDU length</strong>: PDU 的长度为 54 字节。</li>
<li><strong>Remaining lifetime</strong>: 剩余生存时间为 1198。</li>
<li><strong>LSP-ID</strong>: LSP 的 ID 为 0000.0000.0002.00-00。</li>
<li><strong>Sequence number</strong>: 序列号为 0x00000002。</li>
<li><strong>Checksum</strong>: 校验和为 0x6d9a，校验正确。</li>
<li><strong>Type block</strong>: 类型块，该报文表示的 IS 类型为 Level 2。</li>
</ul>
</li>
<li>TLV信息：<ul>
<li><strong>Protocols supported</strong>: 支持的协议，类型为 129，长度为 1。</li>
<li><strong>Area address(es)</strong>: 区域地址，类型为 1，长度为 2，区域地址为 10。</li>
<li><strong>IP Interface address(es)</strong>: IP 接口地址，类型为 132，长度为 4，IPv4 接口地址为 192.168.12.2。</li>
<li><strong>IP Internal reachability</strong>: IP 内部可达性信息，类型为 128，长度为 12，IPv4 前缀（网段）为 192.168.12.0&#x2F;24，cost值为10。（图中未展开，展开后有详细的cost值）</li>
</ul>
</li>
</ul>
<h2 id="LSDB"><a href="#LSDB" class="headerlink" title="LSDB"></a>LSDB</h2><p>在R1上使用<strong>display isis lsdb</strong>命令检查LSDB摘要表。由于是level-1-2路由器，因此R1与R2不仅建立了level-1关系，也建立了level-2关系。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[R1]display isis lsdb</span><br><span class="line"></span><br><span class="line">                        Database information for ISIS(1)</span><br><span class="line">                        --------------------------------</span><br><span class="line"></span><br><span class="line">                          Level-1 Link State Database</span><br><span class="line"></span><br><span class="line">LSPID                 Seq Num      Checksum      Holdtime      Length  ATT/P/OL</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">0000.0000.0001.00-00* 0x00000009   0x6105        1121          68      0/0/0   </span><br><span class="line">0000.0000.0002.00-00  0x00000005   0x7dea        1067          68      0/0/0   </span><br><span class="line">0000.0000.0002.01-00  0x00000003   0xa0e7        1067          55      0/0/0   </span><br><span class="line"></span><br><span class="line">Total LSP(s): 3</span><br><span class="line">    *(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended), </span><br><span class="line">           ATT-Attached, P-Partition, OL-Overload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                          Level-2 Link State Database</span><br><span class="line"></span><br><span class="line">LSPID                 Seq Num      Checksum      Holdtime      Length  ATT/P/OL</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">0000.0000.0001.00-00* 0x0000000a   0x5f06        1121          68      0/0/0   </span><br><span class="line">0000.0000.0002.00-00  0x00000006   0x7beb        1067          68      0/0/0   </span><br><span class="line">0000.0000.0002.01-00  0x00000003   0xa0e7        1067          55      0/0/0   </span><br><span class="line"></span><br><span class="line">Total LSP(s): 3</span><br><span class="line">    *(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended), </span><br><span class="line">           ATT-Attached, P-Partition, OL-Overload</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到有三条LSP，其中第一条为自己，第二条为邻居，第三条为DIS（伪节点）。</p>
<p>我们可以进一步使用<strong>display isis lsdb <em>LSP-ID</em> verbose</strong>命令查看指定LSP的详细信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[R1]display isis lsdb 0000.0000.0002.00-00 verbose</span><br><span class="line"></span><br><span class="line">                        Database information for ISIS(1)</span><br><span class="line">                        --------------------------------</span><br><span class="line"></span><br><span class="line">                          Level-1 Link State Database</span><br><span class="line"></span><br><span class="line">LSPID                 Seq Num      Checksum      Holdtime      Length  ATT/P/OL</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">0000.0000.0002.00-00  0x00000006   0x7beb        1184          68      0/0/0   </span><br><span class="line"> SOURCE       0000.0000.0002.00</span><br><span class="line"> NLPID        IPV4</span><br><span class="line"> AREA ADDR    10 </span><br><span class="line"> INTF ADDR    192.168.12.2</span><br><span class="line"> NBR  ID      0000.0000.0002.01  COST: 10        </span><br><span class="line"> IP-Internal  192.168.12.0    255.255.255.0    COST: 10        </span><br><span class="line"></span><br><span class="line">Total LSP(s): 1</span><br><span class="line">    *(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended), </span><br><span class="line">           ATT-Attached, P-Partition, OL-Overload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                          Level-2 Link State Database</span><br><span class="line"></span><br><span class="line">LSPID                 Seq Num      Checksum      Holdtime      Length  ATT/P/OL</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">0000.0000.0002.00-00  0x00000007   0x79ec        1184          68      0/0/0   </span><br><span class="line"> SOURCE       0000.0000.0002.00</span><br><span class="line"> NLPID        IPV4</span><br><span class="line"> AREA ADDR    10 </span><br><span class="line"> INTF ADDR    192.168.12.2</span><br><span class="line"> NBR  ID      0000.0000.0002.01  COST: 10        </span><br><span class="line"> IP-Internal  192.168.12.0    255.255.255.0    COST: 10        </span><br><span class="line"></span><br><span class="line">Total LSP(s): 1</span><br><span class="line">    *(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended), </span><br><span class="line">           ATT-Attached, P-Partition, OL-Overload</span><br></pre></td></tr></table></figure>



<p>我们也查看以下伪节点的详细信息，比较一下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[R1]display isis lsdb 0000.0000.0002.01-00 verbose</span><br><span class="line"></span><br><span class="line">                        Database information for ISIS(1)</span><br><span class="line">                        --------------------------------</span><br><span class="line"></span><br><span class="line">                          Level-1 Link State Database</span><br><span class="line"></span><br><span class="line">LSPID                 Seq Num      Checksum      Holdtime      Length  ATT/P/OL</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">0000.0000.0002.01-00  0x00000004   0x9ee8        1064          55      0/0/0   </span><br><span class="line"> SOURCE       0000.0000.0002.01</span><br><span class="line"> NLPID        IPV4</span><br><span class="line"> NBR  ID      0000.0000.0002.00  COST: 0         </span><br><span class="line"> NBR  ID      0000.0000.0001.00  COST: 0         </span><br><span class="line"></span><br><span class="line">Total LSP(s): 1</span><br><span class="line">    *(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended), </span><br><span class="line">           ATT-Attached, P-Partition, OL-Overload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                          Level-2 Link State Database</span><br><span class="line"></span><br><span class="line">LSPID                 Seq Num      Checksum      Holdtime      Length  ATT/P/OL</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">0000.0000.0002.01-00  0x00000004   0x9ee8        1064          55      0/0/0   </span><br><span class="line"> SOURCE       0000.0000.0002.01</span><br><span class="line"> NLPID        IPV4</span><br><span class="line"> NBR  ID      0000.0000.0002.00  COST: 0         </span><br><span class="line"> NBR  ID      0000.0000.0001.00  COST: 0         </span><br><span class="line"></span><br><span class="line">Total LSP(s): 1</span><br><span class="line">    *(In TLV)-Leaking Route, *(By LSPID)-Self LSP, +-Self LSP(Extended), </span><br><span class="line">           ATT-Attached, P-Partition, OL-Overload</span><br></pre></td></tr></table></figure>

<p>可以看到伪节点的详细信息与前面表示R2的详细信息有很大的区别。伪节点的信息只包含了伪节点的邻居。</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>正如前言所说，本文只做简单介绍，尤其是配置方面。本文只做基础的配置介绍，其他诸如静默端口、路由汇总、路由渗透、认证等等都不做介绍，请移步到产品文档观看。</p>
<h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><h3 id="创建配置IS-IS进程"><a href="#创建配置IS-IS进程" class="headerlink" title="创建配置IS-IS进程"></a>创建配置IS-IS进程</h3><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>isis</strong> [ <em>process-id</em> ] ，创建IS-IS进程并进入IS-IS视图。</p>
<p>参数<em>process-id</em>用来指定一个IS-IS进程。如果不指定参数<em>process-id</em>，则系统默认的进程为1。</p>
</li>
<li><p>执行命令<strong>network-entity</strong> <em>net</em>，设置网络实体名称。</p>
<p>注意！<strong>该命令相当于给设备分配了区域与系统ID。</strong></p>
<blockquote>
<p><strong>NET地址是全IS-IS网络中对路由器的唯一标识符，它由区域ID+系统ID</strong>+NSAP选择器（默认为00）组成</p>
<p>也别忘了：IS-IS在建立Level-2邻居时，不检查区域地址是否相同，而在建立Level-1邻居时，区域地址必须相同，否则无法建立邻居。</p>
</blockquote>
</li>
<li><p>执行命令<strong>is-level</strong> { <strong>level-1</strong> | <strong>level-1-2</strong> | <strong>level-2</strong> }，设置设备的Level级别。</p>
<p>未指定时，设备的Level级别为<strong>level-1-2</strong>。</p>
</li>
</ol>
<h3 id="在接口启用IS-IS进程"><a href="#在接口启用IS-IS进程" class="headerlink" title="在接口启用IS-IS进程"></a>在接口启用IS-IS进程</h3><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入接口视图。</p>
</li>
<li><p>执行命令<strong>isis enable</strong> [ <em>process-id</em> ]，在该接口启用IS-IS功能，可选指定哪个进程。</p>
<p>配置该命令后，IS-IS将通过该接口建立邻居、扩散LSP报文。</p>
<blockquote>
<p>由于Loopback接口不需要建立邻居，因此如果在Loopback接口下启用IS-IS，只会将该接口所在的网段路由通过其他IS-IS接口发布出去。</p>
</blockquote>
</li>
<li><p>（可选）执行命令<strong>isis circuit-level</strong> [ <strong>level-1</strong> | <strong>level-1-2</strong> | <strong>level-2</strong> ]，设置接口的Level级别。</p>
<p>两台Level-1-2设备建立邻居关系时，默认情况下，会分别建立Level-1和Level-2邻居关系。如果只希望建立Level-1或者Level-2的邻居关系，可以通过修改接口的Level级别实现。</p>
</li>
</ol>
<p>与RIP、OSPF不同，IS-IS在接口启用路由协议需要去接口下配置，是因为IS-IS工作在数据链路层，它并不感知IP地址，因此无法像其他路由协议那样通过“宣告”网段的方式去批量激活接口。</p>
<h3 id="示例与路由引入"><a href="#示例与路由引入" class="headerlink" title="示例与路由引入"></a>示例与路由引入</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://c4893f9d.telegraph-image-713.pages.dev/file/9f847be6989926cea80c1.png"></p>
<p>以该拓扑为例，其中R1、R2、R3、R4、R5为IS-IS网络，而R5连着一OSPF网络，其中存在R6与R7两台路由器。</p>
<p>IS-IS网络属于10.1.0.0&#x2F;16网段的子网，OSPF属于192.168.0.0&#x2F;16网段内的子网。</p>
<p>区域的划分如图中所示，其中左侧为level-1层级的区域，右侧为level-2层级的区域。</p>
<h4 id="基础配置-1"><a href="#基础配置-1" class="headerlink" title="基础配置"></a>基础配置</h4><p>所有路由器的配置如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">R1配置如下：</span><br><span class="line">#</span><br><span class="line"> sysname R1</span><br><span class="line">#</span><br><span class="line">isis 1</span><br><span class="line"> network-entity 49.0123.0000.0000.0001.00</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 10.1.13.1 255.255.255.0 </span><br><span class="line"> isis enable 1</span><br><span class="line"> isis circuit-level level-1</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 10.1.14.1 255.255.255.0 </span><br><span class="line"> isis enable 1</span><br><span class="line"> isis circuit-level level-2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">R2配置如下：</span><br><span class="line">#</span><br><span class="line"> sysname R2</span><br><span class="line">#</span><br><span class="line">isis 1</span><br><span class="line"> network-entity 49.0123.0000.0000.0002.00</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 10.1.23.2 255.255.255.0 </span><br><span class="line"> isis enable 1</span><br><span class="line"> isis circuit-level level-1</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 10.1.24.2 255.255.255.0 </span><br><span class="line"> isis enable 1</span><br><span class="line"> isis circuit-level level-2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">R3配置如下：</span><br><span class="line">#</span><br><span class="line"> sysname R3</span><br><span class="line">#</span><br><span class="line">isis 1</span><br><span class="line"> is-level level-1</span><br><span class="line"> network-entity 49.0123.0000.0000.0003.00</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 10.1.13.3 255.255.255.0 </span><br><span class="line"> isis enable 1</span><br><span class="line"> isis circuit-level level-1</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 10.1.23.3 255.255.255.0 </span><br><span class="line"> isis enable 1</span><br><span class="line"> isis circuit-level level-1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">R4配置如下：</span><br><span class="line">#</span><br><span class="line"> sysname R4</span><br><span class="line">#</span><br><span class="line">isis 1</span><br><span class="line"> is-level level-2</span><br><span class="line"> network-entity 49.0045.0000.0000.0004.00</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 10.1.14.4 255.255.255.0 </span><br><span class="line"> isis enable 1</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 10.1.24.4 255.255.255.0 </span><br><span class="line"> isis enable 1</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> ip address 10.1.45.4 255.255.255.0 </span><br><span class="line"> isis enable 1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">R5配置如下：</span><br><span class="line">#</span><br><span class="line"> sysname R5</span><br><span class="line">#</span><br><span class="line">isis 1</span><br><span class="line"> is-level level-2</span><br><span class="line"> network-entity 49.0045.0000.0000.0005.00</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 10.1.45.5 255.255.255.0 </span><br><span class="line"> isis enable 1</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 192.168.56.5 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> ip address 192.168.57.5 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 5.5.5.5 </span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 192.168.0.0 0.0.255.255 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">R6配置如下：</span><br><span class="line">#</span><br><span class="line"> sysname R6</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 192.168.56.6 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 6.6.6.6 </span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 192.168.56.6 0.0.0.0 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">R7配置如下：</span><br><span class="line">#</span><br><span class="line"> sysname R7</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 192.168.57.7 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 7.7.7.7 </span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 192.168.57.7 0.0.0.0 </span><br></pre></td></tr></table></figure>

<p>完成以上配置后，IS-IS网络内的所有路由器都能互相访问，OSPF网络内的所有路由器也能互相访问。</p>
<h4 id="路由引入"><a href="#路由引入" class="headerlink" title="路由引入"></a>路由引入</h4><p>但IS-IS与OSPF网络之间还无法完全互通，需要在R5上配置路由引入。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[R5]isis 1</span><br><span class="line">[R5-isis-1]import-route ospf 1</span><br></pre></td></tr></table></figure>

<p>配置完之后，我们可以检查R5的isis路由表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[R5]display isis route </span><br><span class="line"></span><br><span class="line">                         Route information for ISIS(1)</span><br><span class="line">                         -----------------------------</span><br><span class="line"></span><br><span class="line">                        ISIS(1) Level-2 Forwarding Table</span><br><span class="line">                        --------------------------------</span><br><span class="line"></span><br><span class="line">IPV4 Destination     IntCost    ExtCost ExitInterface   NextHop         Flags</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">10.1.24.0/24         20         NULL    GE0/0/0         10.1.45.4       A/-/-/-</span><br><span class="line">10.1.14.0/24         20         NULL    GE0/0/0         10.1.45.4       A/-/-/-</span><br><span class="line">10.1.23.0/24         30         NULL    GE0/0/0         10.1.45.4       A/-/-/-</span><br><span class="line">10.1.13.0/24         30         NULL    GE0/0/0         10.1.45.4       A/-/-/-</span><br><span class="line">10.1.45.0/24         10         NULL    GE0/0/0         Direct          D/-/L/-</span><br><span class="line">     Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,</span><br><span class="line">                               U-Up/Down Bit Set</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                       ISIS(1) Level-2 Redistribute Table</span><br><span class="line">                       ----------------------------------</span><br><span class="line"></span><br><span class="line"> Type IPV4 Destination     IntCost    ExtCost Tag       </span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line"> D    192.168.57.0/24      0          0      </span><br><span class="line"> D    192.168.56.0/24      0          0      </span><br><span class="line"></span><br><span class="line">         Type: D-Direct, I-ISIS, S-Static, O-OSPF, B-BGP, R-RIP, U-UNR</span><br></pre></td></tr></table></figure>

<p>R5的isis路由表中出现了Redistribute Table（重定向表）一栏，包含了引入的OSPF路由。</p>
<p>还记得通信是双向的吗，虽然引入了OSPF路由，IS-IS网络内的路由器是拥有了OSPF网络内的路由信息，但OSPF中的路由器没有到IS-IS网络的信息。</p>
<p>因此，还得在R5上的ospf进程中，引入is-is路由。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[R5]ospf</span><br><span class="line">[R5-ospf-1]import-route isis 1</span><br></pre></td></tr></table></figure>

<p>在R6上检查是否引入成功（OSPF里，R5作为引入者，无法查看到）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[R6]display ospf routing </span><br><span class="line"></span><br><span class="line">	 OSPF Process 1 with Router ID 6.6.6.6</span><br><span class="line">		  Routing Tables </span><br><span class="line"></span><br><span class="line"> Routing for Network </span><br><span class="line"> Destination        Cost  Type       NextHop         AdvRouter       Area</span><br><span class="line"> 192.168.56.0/24    1     Transit    192.168.56.6    6.6.6.6         0.0.0.0</span><br><span class="line"> 192.168.57.0/24    2     Transit    192.168.56.5    7.7.7.7         0.0.0.0</span><br><span class="line"></span><br><span class="line"> Routing for ASEs</span><br><span class="line"> Destination        Cost      Type       Tag         NextHop         AdvRouter</span><br><span class="line"> 10.1.13.0/24       1         Type2      1           192.168.56.5    5.5.5.5</span><br><span class="line"> 10.1.14.0/24       1         Type2      1           192.168.56.5    5.5.5.5</span><br><span class="line"> 10.1.23.0/24       1         Type2      1           192.168.56.5    5.5.5.5</span><br><span class="line"> 10.1.24.0/24       1         Type2      1           192.168.56.5    5.5.5.5</span><br><span class="line"> 10.1.45.0/24       1         Type2      1           192.168.56.5    5.5.5.5</span><br><span class="line"></span><br><span class="line"> Total Nets: 7  </span><br><span class="line"> Intra Area: 2  Inter Area: 0  ASE: 5  NSSA: 0 </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们也去检查下IS-IS网络中R1的路由：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[R1]display isis route </span><br><span class="line"></span><br><span class="line">                         Route information for ISIS(1)</span><br><span class="line">                         -----------------------------</span><br><span class="line"></span><br><span class="line">                        ISIS(1) Level-1 Forwarding Table</span><br><span class="line">                        --------------------------------</span><br><span class="line"></span><br><span class="line">IPV4 Destination     IntCost    ExtCost ExitInterface   NextHop         Flags</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">0.0.0.0/0            20         NULL   </span><br><span class="line">10.1.23.0/24         20         NULL    GE0/0/0         10.1.13.3       A/-/L/-</span><br><span class="line">10.1.13.0/24         10         NULL    GE0/0/0         Direct          D/-/L/-</span><br><span class="line">     Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,</span><br><span class="line">                               U-Up/Down Bit Set</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        ISIS(1) Level-2 Forwarding Table</span><br><span class="line">                        --------------------------------</span><br><span class="line"></span><br><span class="line">IPV4 Destination     IntCost    ExtCost ExitInterface   NextHop         Flags</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">10.1.24.0/24         20         NULL    GE0/0/1         10.1.14.4       A/-/-/-</span><br><span class="line">10.1.14.0/24         10         NULL    GE0/0/1         Direct          D/-/L/-</span><br><span class="line">10.1.23.0/24         30         NULL   </span><br><span class="line">10.1.13.0/24         10         NULL    GE0/0/0         Direct          D/-/L/-</span><br><span class="line">192.168.57.0/24      20         0       GE0/0/1         10.1.14.4       A/-/-/-</span><br><span class="line">10.1.45.0/24         20         NULL    GE0/0/1         10.1.14.4       A/-/-/-</span><br><span class="line">192.168.56.0/24      20         0       GE0/0/1         10.1.14.4       A/-/-/-</span><br><span class="line">     Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,</span><br><span class="line">                               U-Up/Down Bit Set</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[R1]ping 192.168.56.6</span><br><span class="line">  PING 192.168.56.6: 56  data bytes, press CTRL_C to break</span><br><span class="line">    Reply from 192.168.56.6: bytes=56 Sequence=1 ttl=253 time=50 ms</span><br><span class="line">    Reply from 192.168.56.6: bytes=56 Sequence=2 ttl=253 time=30 ms</span><br><span class="line">    Reply from 192.168.56.6: bytes=56 Sequence=3 ttl=253 time=30 ms</span><br><span class="line">    Reply from 192.168.56.6: bytes=56 Sequence=4 ttl=253 time=30 ms</span><br><span class="line">    Reply from 192.168.56.6: bytes=56 Sequence=5 ttl=253 time=40 ms</span><br><span class="line"></span><br><span class="line">  --- 192.168.56.6 ping statistics ---</span><br><span class="line">    5 packet(s) transmitted</span><br><span class="line">    5 packet(s) received</span><br><span class="line">    0.00% packet loss</span><br><span class="line">    round-trip min/avg/max = 30/36/50 ms</span><br></pre></td></tr></table></figure>

<p>可以发现没有问题，也能访问到。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>本文主要是让读者知道IS-IS的基础概念与基本原理，甚至能搭建一个“能通”的IS-IS网络；至于实际的报文细节、内部的处理与配置细节都大幅弱化了。</p>
<p>如果读者有兴趣想深入学习，建立在模拟器搭建IS-IS拓扑，在模拟器内检查各信息并配合抓包工具进行观察。</p>
<p>或者说去找专门的课程视频学习。</p>
<p>此外，本文介绍的是ipv4场景的IS-IS，ipv6场景的IS-IS以后有机会我们再介绍吧。</p>
<blockquote>
<p><del>但实际工作中，估计几乎用不到。</del></p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://magiku.github.io">Magiku</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://magiku.github.io/2024/07/01/%E3%80%90%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B12%E3%80%91IS-IS/">https://magiku.github.io/2024/07/01/%E3%80%90%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B12%E3%80%91IS-IS/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，转载请注明出处！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C/">网络</a></div><div class="post_share"><div class="social-share" data-image="https://c4893f9d.telegraph-image-713.pages.dev/file/dcb11262f483239ffc471.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/08/%E3%80%90%E7%A7%91%E6%99%AE-%E8%BF%90%E7%BB%B4%E3%80%91%E7%BD%91%E7%BB%9C%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E6%89%8B%E5%86%8C/" title="【科普/运维】网络故障排查手册"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【科普/运维】网络故障排查手册</div></div></a></div><div class="next-post pull-right"><a href="/2024/06/28/%E3%80%90%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B11%E3%80%91ospf%E8%AF%A6%E8%A7%A3/" title="【动态路由1】ospf详解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【动态路由1】ospf详解</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/10/19/%E3%80%90%E7%A7%91%E6%99%AE%E3%80%91%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%A6%82%E8%BF%B0/" title="【科普】计算机网络概述"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-19</div><div class="title">【科普】计算机网络概述</div></div></a></div><div><a href="/2023/12/11/%E3%80%90%E4%BA%A4%E6%8D%A2%E5%9F%BA%E7%A1%80%E3%80%91vlan%E3%80%81%E6%8E%A5%E5%8F%A3%E7%B1%BB%E5%9E%8B%E3%80%81vlanif/" title="【交换基础】vlan、接口类型、vlanif"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-11</div><div class="title">【交换基础】vlan、接口类型、vlanif</div></div></a></div><div><a href="/2024/01/03/%E7%94%9F%E6%88%90%E6%A0%91%E5%8D%8F%E8%AE%AE%E4%B9%8BSTP%E4%B8%8ERSTP/" title="【生成树协议】STP、RSTP"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-03</div><div class="title">【生成树协议】STP、RSTP</div></div></a></div><div><a href="/2024/06/04/%E3%80%90%E8%B7%AF%E7%94%B1%E5%9F%BA%E7%A1%80%E3%80%91%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E3%80%81RIP%E5%8D%8F%E8%AE%AE/" title="【路由基础】静态路由、RIP协议"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-04</div><div class="title">【路由基础】静态路由、RIP协议</div></div></a></div><div><a href="/2024/06/28/%E3%80%90%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B11%E3%80%91ospf%E8%AF%A6%E8%A7%A3/" title="【动态路由1】ospf详解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-28</div><div class="title">【动态路由1】ospf详解</div></div></a></div><div><a href="/2024/06/19/%E3%80%90%E7%A7%91%E6%99%AE%E3%80%91%EF%BC%88%E8%BD%AF%E4%BB%B6%E5%90%91%EF%BC%89%E7%BD%91%E7%BB%9C%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/" title="【科普】（软件向）网络运维工具的介绍与使用技巧"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-19</div><div class="title">【科普】（软件向）网络运维工具的介绍与使用技巧</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://c4893f9d.telegraph-image-713.pages.dev/file/dcb11262f483239ffc471.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Magiku</div><div class="author-info__description">个人博客，用于记录知识库。<br>希望这些笔记能对你有所帮助！<br>要是有什么需要交流的，欢迎联系我~</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" href="/about/"><i class="fas fa-heart"></i><span>about</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://c4893f9d.telegraph-image-713.pages.dev/file/5fc03bf783d0242724fb7.png" target="_blank" title="QQ"><i class="fab fa-qq" style="color: #6899ee;"></i></a><a class="social-icon" href="https://c4893f9d.telegraph-image-713.pages.dev/file/7fbd32e8ba0698d529856.png" target="_blank" title="微信"><i class="fab fa-weixin" style="color: #44d55c;"></i></a><a class="social-icon" href="https://space.bilibili.com/39293027" target="_blank" title="哔哩哔哩"><i class="fab fa-bilibili" style="color: #e3d9;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">基本原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text">路由器类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-1-%E8%B7%AF%E7%94%B1%E5%99%A8%EF%BC%9A"><span class="toc-number">2.1.1.</span> <span class="toc-text">Level-1 路由器：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-2-%E8%B7%AF%E7%94%B1%E5%99%A8%EF%BC%9A"><span class="toc-number">2.1.2.</span> <span class="toc-text">Level-2 路由器：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Level-1-2-%E8%B7%AF%E7%94%B1%E5%99%A8%EF%BC%9A"><span class="toc-number">2.1.3.</span> <span class="toc-text">Level-1-2 路由器：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%80%BB%E7%BB%93"><span class="toc-number">2.1.4.</span> <span class="toc-text">类型总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9FID"><span class="toc-number">2.2.</span> <span class="toc-text">系统ID</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BA%E5%9F%9F"><span class="toc-number">2.3.</span> <span class="toc-text">区域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%9F%9F-id"><span class="toc-number">2.3.1.</span> <span class="toc-text">区域 id</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%9F%9F%E5%88%92%E5%88%86"><span class="toc-number">2.3.2.</span> <span class="toc-text">区域划分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">2.3.3.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NET%E5%9C%B0%E5%9D%80"><span class="toc-number">2.4.</span> <span class="toc-text">NET地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%A6%E9%87%8F%E5%80%BC"><span class="toc-number">2.5.</span> <span class="toc-text">度量值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E6%8A%A5%E6%96%87"><span class="toc-number">2.6.</span> <span class="toc-text">协议报文</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IIH%EF%BC%88IS-IS-Hello%EF%BC%89"><span class="toc-number">2.6.1.</span> <span class="toc-text">IIH（IS-IS Hello）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LSP%EF%BC%88Link-State-Packet%EF%BC%89"><span class="toc-number">2.6.2.</span> <span class="toc-text">LSP（Link-State Packet）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSNP%EF%BC%88Complete-Sequence-Number-PDU%EF%BC%89"><span class="toc-number">2.6.3.</span> <span class="toc-text">CSNP（Complete Sequence Number PDU）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PSNP%EF%BC%88Partial-Sequence-Number-PDU%EF%BC%89"><span class="toc-number">2.6.4.</span> <span class="toc-text">PSNP（Partial Sequence Number PDU）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E7%A4%BA"><span class="toc-number">2.6.5.</span> <span class="toc-text">提示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DIS%E4%B8%8E%E4%BC%AA%E8%8A%82%E7%82%B9"><span class="toc-number">2.7.</span> <span class="toc-text">DIS与伪节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DIS"><span class="toc-number">2.7.1.</span> <span class="toc-text">DIS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%AA%E8%8A%82%E7%82%B9"><span class="toc-number">2.7.2.</span> <span class="toc-text">伪节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-1"><span class="toc-number">2.7.3.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%82%BB%E5%B1%85%E5%BB%BA%E7%AB%8B%E8%BF%87%E7%A8%8B"><span class="toc-number">2.8.</span> <span class="toc-text">邻居建立过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD%E7%BD%91%E7%BB%9C"><span class="toc-number">2.8.1.</span> <span class="toc-text">广播网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P2P%E7%BD%91%E7%BB%9C"><span class="toc-number">2.8.2.</span> <span class="toc-text">P2P网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E6%AC%A1%E6%8F%A1%E6%89%8B"><span class="toc-number">2.8.2.1.</span> <span class="toc-text">两次握手</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B"><span class="toc-number">2.8.2.2.</span> <span class="toc-text">三次握手</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%82%BB%E5%B1%85%E5%BB%BA%E7%AB%8B%E5%90%8E"><span class="toc-number">2.9.</span> <span class="toc-text">邻居建立后</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD%E7%BD%91%E7%BB%9C-1"><span class="toc-number">2.9.1.</span> <span class="toc-text">广播网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P2P%E7%BD%91%E7%BB%9C-1"><span class="toc-number">2.9.2.</span> <span class="toc-text">P2P网络</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%A5%E6%96%87%E4%B8%8ELSDB%E8%AF%A6%E8%A7%A3"><span class="toc-number">3.</span> <span class="toc-text">报文与LSDB详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TLV%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.</span> <span class="toc-text">TLV介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IIH-%EF%BC%88hello%E6%8A%A5%E6%96%87%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">IIH （hello报文）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LSP%E6%8A%A5%E6%96%87"><span class="toc-number">3.3.</span> <span class="toc-text">LSP报文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LSDB"><span class="toc-number">3.4.</span> <span class="toc-text">LSDB</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">4.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.</span> <span class="toc-text">基础配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AEIS-IS%E8%BF%9B%E7%A8%8B"><span class="toc-number">4.1.1.</span> <span class="toc-text">创建配置IS-IS进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%8E%A5%E5%8F%A3%E5%90%AF%E7%94%A8IS-IS%E8%BF%9B%E7%A8%8B"><span class="toc-number">4.1.2.</span> <span class="toc-text">在接口启用IS-IS进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%B8%8E%E8%B7%AF%E7%94%B1%E5%BC%95%E5%85%A5"><span class="toc-number">4.1.3.</span> <span class="toc-text">示例与路由引入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE-1"><span class="toc-number">4.1.3.1.</span> <span class="toc-text">基础配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%BC%95%E5%85%A5"><span class="toc-number">4.1.3.2.</span> <span class="toc-text">路由引入</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">5.</span> <span class="toc-text">结语</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Magiku</div><div class="footer_custom_text"></p></a>&nbsp;<a target="_blank" href="https://github.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'd55e9307ca605124a542',
      clientSecret: '73a85d39b9bda1aa0f24ac51ea5a9504edf02277',
      repo: 'magiku.github.io',
      owner: 'magiku',
      admin: ['magiku'],
      id: '00f7f838eca8a00e61addf1026f24bb4',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.textContent= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://magiku.github.io/categories/计算机网络/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📚 计算机网络 (12)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://magiku.github.io/categories/个人杂谈/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 磨叽墨迹 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://magiku.github.io/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1s');
    arr[i].setAttribute('data-wow-delay', '0.5s');
    arr[i].setAttribute('data-wow-offset', '0');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.8/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = '39b2c1fede67489eb9265b983874c66d';
  var gaud_map_key = '84b1f52230bfdc06111b20984a0b04d9';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '113.324587,23.106574';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.8/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>